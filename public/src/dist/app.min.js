!function(t){"use strict";function e(t){t.theme("default").primaryPalette("indigo").accentPalette("pink")}t.module("waka",["ui.router","ngResource","ngSanitize","ngMaterial","ngFileUpload","ngImgCrop"]),t.module("waka").config(["$mdThemingProvider",e])}(angular),function(t){"use strict";function e(t,e){t.state("user-login",{url:"/user-login",templateUrl:"app/routes/user-login/user-login.html",controller:"loginController",controllerAs:"account"}).state("home-page",{url:"/home-page",templateUrl:"app/routes/home-page/home-page.html",controller:"homeController",controllerAs:"home"}).state("user-setting",{url:"/user-setting",templateUrl:"app/routes/user-setting/user-setting.html",controller:"userSettingController",controllerAs:"vm"}).state("user-page",{url:"/user-page",templateUrl:"app/routes/user-page/user-page.html",controller:"userPageController",controllerAs:"vm"}).state("user-page.answer",{url:"/answer",views:{"user-page":{templateUrl:"app/routes/user-page-answer/user-page-answer.html",controller:"userAnswerController",controllerAs:"vm"}}}).state("user-page.collection",{url:"/collection",views:{"user-page":{templateUrl:"app/routes/user-page-collection/user-page-collection.html",controller:"userCollectionController",controllerAs:"vm"}}}).state("user-page.question",{url:"/question",views:{"user-page":{templateUrl:"app/routes/user-page-question/user-page-question.html",controller:"userQuestionController",controllerAs:"vm"}}}).state("user-page.topic",{url:"/topic",views:{"user-page":{templateUrl:"app/routes/user-page-topic/user-page-topic.html",controller:"userTopicController",controllerAs:"vm"}}}).state("user-page.mes",{url:"/mes",views:{"user-page":{templateUrl:"app/routes/user-page-mes/user-page-mes.html",controller:"userMesController",controllerAs:"vm"}}}).state("find-question",{url:"/find-question",templateUrl:"app/routes/find-question-page/find-question-page.html",controller:"findQuestionController",controllerAs:"vm"}).state("question",{url:"/question/:question_id",templateUrl:"app/routes/question/question.html",controller:"questionController",controllerAs:"vm"}).state("question-editor",{url:"/question-editor",templateUrl:"app/routes/question-editor/question-editor.html",controller:"questionEditorController",controllerAs:"vm"}).state("answer-editor",{url:"/answer-editor/:question_id",templateUrl:"app/routes/answer-editor/answer-editor.html",controller:"answerEditorController",controllerAs:"vm"}).state("topic",{url:"/topic",templateUrl:"app/routes/topic/topic.html",controller:"topicController",controllerAs:"vm"}).state("topic.tree",{url:"/:topic_id",templateUrl:"app/routes/topic-tree/topic-tree.html",controller:"topicTreeController",controllerAs:"tree"}).state("search",{url:"/search/:keyword",templateUrl:"app/routes/search-result/search-result.html",controller:"searchController",controllerAs:"vm"}),e.otherwise("/user-login")}t.module("waka").config(["$stateProvider","$urlRouterProvider",e])}(angular),function(t){"use strict";var e="api";t.module("waka").factory("URL",[function(){return e+"/"}]).factory("User",["$resource",function(t){var o=e+"/user/";return t(e+"/user/:id",{id:"@id"},{login:{method:"POST",url:o+"login"},logout:{method:"GET",url:o+"logout"},getCurrentUser:{method:"GET",url:o+"currentUser"},update:{method:"POST",url:o+"update"},updatePassword:{method:"POST",url:o+"password"},getFollowingTopic:{method:"GET",url:o+"followingTopic/:_id",params:{_id:"@_id"}},getFollowingTopicAll:{method:"GET",url:o+"followingTopicAll/:_id",params:{_id:"@_id"}}})}]).factory("Question",["$resource",function(t){var o=e+"/question/";return t(e+"/question/:question_id",{question_id:"@question_id"},{add:{method:"POST",url:o+"add"},search:{method:"POST",url:o+"search"},update:{method:"POST",url:o+"update"},getNoAnswer:{method:"POST",url:o+"getNoAnswer"},getNew:{method:"POST",url:o+"getNew"},getHot:{method:"POST",url:o+"getHot"},getByUser:{method:"GET",url:o+"getByUser/:author_id",params:{author_id:"@author_id"}},attitude:{method:"POST",url:o+"attitude"},follow:{method:"POST",url:o+"follow"},unfollow:{method:"POST",url:o+"unfollow"},getFollower:{method:"GET",url:o+"getFollowers/:question_id",params:{question_id:"@question_id"}},getFollowList:{method:"GET",url:o+"getFollowList/:follower_id",params:{follower_id:"@follower_id"}}})}]).factory("Answer",["$resource",function(t){var o=e+"/answer/";return t(e+"/answer",{},{getByTopic:{method:"POST",url:o+"getByTopic"},getByUserTopics:{method:"POST",url:o+"getByUserTopics"},getByQuestion:{method:"GET",url:o+"getByQuestion/:question_id",params:{question_id:"@question_id"}},getByUser:{method:"GET",url:o+"getByUser/:author_id",params:{author_id:"@author_id"}},getByUserAndQuestion:{method:"POST",url:o+"getByUserAndQuestion"},collection:{method:"GET",url:o+"collection/:user_id",params:{user_id:"@user_id"}},addCollection:{method:"POST",url:o+"addCollection"},checkCollection:{method:"POST",url:o+"checkCollection"},attitude:{method:"POST",url:o+"attitude"},add:{method:"POST",url:o+"add"},update:{method:"POST",url:o+"update"},del:{method:"POST",url:o+"del"}})}]).factory("Topic",["$resource",function(t){var o=e+"/topic/";return t(e+"/topic/:_id",{_id:"@_id"},{add:{method:"POST",url:o+"add"},sub:{method:"GET",url:o+"sub/:_id",params:{_id:"@_id"}},getAllChild:{method:"GET",url:o+"allChild/:_id",params:{_id:"@_id"}},update:{method:"POST",url:o+"update"},list:{method:"GET",url:o+"list"},getTopicsId:{method:"POST",url:o+"getTopicsId"},getTopicByIdList:{method:"POST",url:o+"getTopicByIdList"}})}]).factory("Reply",["$resource",function(t){var o=e+"/reply/";return t(e+"/reply",{},{add:{method:"POST",url:o+"add"},update:{method:"POST",url:o+"update"},del:{method:"POST",url:o+"del"},list:{method:"GET",url:o+"list/:answer_id",params:{answer_id:"@answer_id"}}})}]).factory("Message",["$resource",function(t){var o=e+"/message/";return t(e+"/message",{},{getMes:{method:"POST",url:o+"getMes"}})}]).factory("Attitude",["$resource",function(t){var o=e+"/attitude/";return t(e+"/attitude",{},{getAttitude:{method:"POST",url:o+"getAttitude"},setAttitude:{method:"POST",url:o+"setAttitude"}})}])}(angular),function(t){"use strict";t.module("waka").factory("iAES",function(){return{encrypt:function(t){return CryptoJS.AES.encrypt(t,"iwaka")},decrypt:function(t){return CryptoJS.AES.decrypt(t,"iwaka").toString(CryptoJS.enc.Utf8)}}}).factory("iCookie",function(){return{setUserCookie:function(t,e,o){document.cookie="uid="+t+";max-age=864000",document.cookie="username="+e+";max-age=864000",document.cookie="password="+o+";max-age=864000"},setCookie:function(t,e,o){document.cookie=t+"="+e+";max-age="+o},getCookie:function(t){var e=document.cookie;if(e){e=e.substr(e.indexOf(t));var o=e.indexOf(";")>-1?e.indexOf(";"):e.length,n=e.substring(e.indexOf("=")+1,o);return n}return null},cancelCookie:function(){var t=document.cookie.split(";");t.forEach(function(t){document.cookie=t+";max-age=0"})},updatePasswordCookie:function(t){t=t,document.cookie="password="+t+";max-age=864000"}}})}(angular),function(t){"use strict";t.module("waka").factory("timeFormat",function(){return{postedTime:function(t){var e=new Date(t),o=new Date,n=(o-e)/6e4;return n<=60?Math.floor(n)+"分钟前":n>60&&n<=1440?Math.floor(n/60)+"小时前":n>1440&&n<=28800?Math.floor(n/1440)+"天前":e.getUTCFullYear()+"-"+(e.getMonth()+1)+"-"+e.getUTCDate()}}})}(angular),function(t){"use strict";function e(){function t(t,e,o,n){function i(){r()}function r(){var t=location.href.split("#/topic/")[1];n.get({_id:t}).$promise.then(function(t){s.parentTopic=t.data})}var s=this;s.parentTopic="",s.topicToAdd="",s.cancel=function(){o.cancel()},s.addTopic=function(){if(!s.topicToAdd)return void alert("话题名不能为空");var t={name:s.topicToAdd,parent:s.parentTopic.name};o.hide(),n.add(t).$promise.then(function(t){t.status>-1&&(alert("添加成功"),s.initTree(),e.reload())})},i()}var e={restrict:"E",templateUrl:"app/components/dialog/dialog.html",scope:{initTree:"&"},controller:t,controllerAs:"vm",bindToController:!0};return e}t.module("waka").directive("topicDialog",e)}(angular),function(t){function e(){function t(t,e,o,n,i){function r(){a.value(s.content)}var s=this,a=new SimpleMDE({element:document.getElementById("editor"),spellChecker:!1});t.$watch("vm.content",function(){o(function(){r()},2e3)}),s.simplemde=a,s.submit=function(){},s.show=function(){console.log(a.markdown(a.value())),alert(a.value())}}var e={restrict:"E",templateUrl:"app/components/editor/editor.html",scope:{content:"=",drContentHtml:"=",simplemde:"="},controller:t,controllerAs:"editor",bindToController:!0};return e}t.module("waka").directive("myEditor",e)}(angular),function(t){"use strict";function e(){function t(t,e,o,n,i){function r(){location.href="/#/user-page/question"}function s(){location.href="/#/user-setting"}function a(){l(),n.logout(),e.go("user-login")}function u(){n.get({id:c("uid")}).$promise.then(function(t){d.avatar="../assets/images/user/"+t.data.avatar})}function l(){var t=document.cookie.split(";");t.forEach(function(t){document.cookie=t+";max-age=0"})}function c(t){var e=document.cookie;if(e){e=e.substr(e.indexOf(t));var o=e.indexOf(";")>-1?e.indexOf(";"):e.length,n=e.substring(e.indexOf("=")+1,o);return n}return null}var d=this,p="../assets/images/icons/";d.isOpen=!1,d.tooltipVisible=!1,d.avatar="../assets/images/user/default.png",u(),t.$watch("vm.isOpen",function(t){t?o(function(){d.tooltipVisible=d.isOpen},600):d.tooltipVisible=d.isOpen}),d.items=[{name:"我的主页",icon:p+"people.svg",direction:"left",action:"toHomePage"},{name:"修改信息",icon:p+"setting.svg",direction:"left",action:"toUpdateInfo"},{name:"退出",icon:p+"logout.svg",direction:"left",action:"logout"}],d.addQuestion=function(){e.go("question-editor")},d.action=function(t){switch(t){case"toHomePage":r();break;case"toUpdateInfo":s();break;case"logout":a()}}}function e(t,e,o){var n=document.getElementById("search"),i="";n.addEventListener("keydown",function(t){i=this.value},!1),n.addEventListener("keyup",function(t){var e=t.keyCode;13==e&&i===this.value&&(console.log(this.value),location.href="/#/search/"+this.value)},!1)}var o={restrict:"E",link:e,templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:t,controllerAs:"vm",bindToController:!0};return o}t.module("waka").directive("navBar",e)}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){l();var t={question_id:d,author_id:p,content:c.content,contentHtml:c.contentHtml};console.log(t),n.add(JSON.stringify(t)).$promise.then(function(t){t.status>-1?(alert("添加回答成功"),location.href="/#/question/"+d):alert("添加回答失败")})}function s(){l();var t={_id:f,author_id:p,content:c.content,contentHtml:c.contentHtml};console.log(t),n.update(JSON.stringify(t)).$promise.then(function(t){console.log(t),t.status>-1?(alert("更新回答成功"),location.href="/#/question/"+d):alert("更新回答失败")})}function a(){var t={question_id:d,author_id:p};console.log(t),n.getByUserAndQuestion(JSON.stringify(t)).$promise.then(function(t){if(t.data[0]){var e=t.data[0];c.hasAnswer=!0,c.content=e.answer.content,c.title=e.question.title,f=e.answer._id}else u(d)})}function u(t){o.get({question_id:t}).$promise.then(function(t){var e=t.data[0];c.title=e.question.title})}function l(){c.simplemde?(c.content=c.simplemde.value(),c.contentHtml=c.simplemde.markdown(c.simplemde.value())):alert("getContent error")}var c=this,d=location.hash.split("/")[2],p=i.getCookie("uid"),f="";c.simplemde="",c.content="",c.contentHtml="",c.title="",c.hasAnswer=!1,c.addAnswer=r,c.updateAnswer=s,a()}t.module("waka").controller("answerEditorController",["$scope","$state","Question","Answer","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i,r,s,a){function u(){l(),o(function(){c(),d()},500)}function l(){p(function(t){var e={topics:t};n.getNew(JSON.stringify(e)).$promise.then(function(t){console.log("getNew"),console.log(t),m.questionNew=t.data})})}function c(){p(function(t){var e={topics:t};n.getHot(JSON.stringify(e)).$promise.then(function(t){console.log("getHot"),console.log(t),m.questionHot=t.data})})}function d(){p(function(t){var e={topics:t};n.getNoAnswer(JSON.stringify(e)).$promise.then(function(t){console.log("getNoAnswer"),console.log(t),m.questionNoAnswer=t.data})})}function p(t){return m.followingTopicIdList?void t(m.followingTopicIdList):void r.getFollowingTopicAll({_id:s.getCookie("uid")}).$promise.then(function(e){e.data.user;if(console.log("getFollowingTopic"),console.log(e),e.data.topics.length>0){var o=e.data.topics.map(function(t){return t._id});m.followingTopicIdList=o,t(o)}else f(function(e){var o=e.map(function(t){return t._id});t(o)})})}function f(t){m.allTopics?t(m.allTopics):i.list().$promise.then(function(e){m.allTopics=e.data,t(e.data)})}var m=this;m.postedTime=a.postedTime,m.allTopics="",m.followingTopic="",m.questionNew="",m.questionHot="",m.questionNoAnswer="",u()}t.module("waka").controller("findQuestionController",["$scope","$state","$timeout","Question","Topic","User","iCookie","timeFormat",e])}(angular),function(t){"use strict";function e(t,e,o,n,i,r){function s(){a(function(t){var e={topicList:t};n.getByUserTopics(JSON.stringify(e)).$promise.then(function(t){console.log(t),l.answerList=t.data,t.data.forEach(function(t,e){e%2===0?l.answerListRight.push(t):l.answerListLeft.push(t)})})})}function a(t){return l.followingTopicIdList?void t(l.followingTopicIdList):void o.getFollowingTopicAll({_id:r.getCookie("uid")}).$promise.then(function(e){e.data.user;if(e.data.topics.length>0){var o=e.data.topics.map(function(t){return t._id});l.followingTopicIdList=o,t(o)}else u(function(e){var o=e.map(function(t){return t._id});t(o)})})}function u(t){l.allTopics?t(l.allTopics):i.list().$promise.then(function(e){l.allTopics=e.data,t(e.data)})}var l=this;l.allTopics="",l.followingTopic="",l.answerList="",l.answerListLeft=[],l.answerListRight=[],s()}t.module("waka").controller("homeController",["$scope","$state","User","Answer","Topic","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i,r,s,a,u){function l(t){var e={user_id:O,question_id:S.question._id,type:t};s.setAttitude(JSON.stringify(e)).$promise.then(function(e){e.status>-1&&(e.data.question?S.question=e.data.question:t>0?S.question.support_count++:S.question.support_count--,S.question.attitude=e.data.attitude)})}function c(t,e){var o={user_id:O,answer_id:S.answerList[e].answer._id,type:t};s.setAttitude(JSON.stringify(o)).$promise.then(function(o){o.status>-1&&(console.log("answer attitude"),console.log(o),o.data.answer?S.answerList[e].answer=o.data.answer:t>0?S.answerList[e].answer.support_count++:S.answerList[e].answer.support_count--,S.answerList[e].attitude=o.data.attitude)})}function d(){console.log(A),n.get({question_id:A}).$promise.then(function(t){if(t.status>-1){console.log(t);var e=t.data[0];S.question=e.question,S.question.author=e.author,S.question.topics=e.topics,S.question.createdTime=i.postedTime(S.question.created_time),f(S.question._id),p(S.question._id)}else alert("getQuestion error")})}function p(t){r.getByQuestion({question_id:t}).$promise.then(function(t){t.status>-1?(S.answerList=t.data,m(),C()):alert("getAnswers error")})}function f(t){var e={user_id:O,question_id:t};s.getAttitude(JSON.stringify(e)).$promise.then(function(t){t.status>-1&&(S.question.attitude=t.data[0])})}function m(){S.answerList.forEach(function(t,e){var o={user_id:O,answer_id:t.answer._id};s.getAttitude(JSON.stringify(o)).$promise.then(function(t){t.status>-1&&(S.answerList[e].attitude=t.data[0])})})}function g(){location.href="/#/answer-editor/"+A}function h(t){return u.getCookie("uid")==t}function w(){var t={follower_id:O,question_id:A};n.follow(JSON.stringify(t)).$promise.then(function(t){t.status>-1&&(S.question.following_count++,e.reload())})}function v(){var t={question_id:A,follower_id:O};n.unfollow(JSON.stringify(t)).$promise.then(function(t){t.status>-1&&(S.question.following_count--,e.reload())})}function T(){n.getFollower({question_id:A}).$promise.then(function(t){var e=t.data;e.forEach(function(t){t._id==O&&(S.isFollowing=!0)})})}function _(t){var e={answer_id:t,user_id:O};r.addCollection(JSON.stringify(e)).$promise.then(function(t){t.status>-1&&(alert("添加收藏成功"),location.reload())})}function C(){S.answerList.forEach(function(t,e){$(t.answer._id,e)})}function $(t,e){var o={user_id:O,answer_id:t};r.checkCollection(JSON.stringify(o)).$promise.then(function(t){t.status>-1&&(S.answerList[e].collected=!0)})}function k(t,e){a.list({answer_id:t}).$promise.then(function(t){t.status>-1&&(console.log(t),S.answerList[e].replys=t.data)})}function y(t,e){var o={answer_id:t,author_id:O,content:S.replyContentList[e]};a.add(JSON.stringify(o)).$promise.then(function(t){t.status>-1&&(alert("评论成功"),location.reload())})}function q(t,e){S.replyList[e]?S.replyList[e]=!1:(S.replyList[e]=!0,k(t,e))}var S=this,A=location.hash.split("/")[2],O=u.getCookie("uid");S.answerList=[],S.question="",S.addAnswer=g,S.checkAuthor=h,S.setQuestionAttitude=l,S.setAnswerAttitude=c,S.followQuestion=w,S.unfollowQuestion=v,S.addCollection=_,S.loadReply=k,S.addReply=y,S.openReplyBox=q,S.isFollowing=!1,S.replyList=[],S.replyContentList=[],d(),T(),S.postedTime=i.postedTime}t.module("waka").controller("questionController",["$scope","$state","$sce","Question","timeFormat","Answer","Attitude","Reply","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){c.simplemde?(c.content=c.simplemde.value(),c.contentHtml=c.simplemde.markdown(c.simplemde.value())):alert("getContent error")}function s(){if(!c.title||!c.topics)return void alert("标题跟话题分类不能为空");var t=c.topics.map(function(t){return t._id});r();var e={title:c.title,topics:t,content:c.content,contentHtml:c.contentHtml,author_id:i.getCookie("uid")};console.log(e),o.add(JSON.stringify(e)).$promise.then(function(t){t.status===-1?alert("添加问题失败"):(console.log("添加问题成功"),location.href="/#/question/"+t.data._id)})}function a(t){var e=t?c.allTopics.filter(u(t)):[];return e}function u(t){return function(e){return e.name.indexOf(t)!==-1}}function l(){n.list().$promise.then(function(t){c.allTopics=t.data,c.querySearch=a})}var c=this;c.querySearch="",c.allTopics=[],c.topics=[],c.filterSelected=!0,c.content="",c.contentHtml="",c.title="",c.simplemde="",c.submit=s,l()}t.module("waka").controller("questionEditorController",["$scope","$state","Question","Topic","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){if(location.href.indexOf("search/")>-1){var t=location.href.split("search/")[1];return decodeURI(t)}}function s(){var t={keyword:r()};n.search(JSON.stringify(t)).$promise.then(function(t){t.status>-1&&(a.questionList=t.data)})}var a=this;i.getCookie("uid");a.questionList=[],s()}t.module("waka").controller("searchController",["$scope","$state","User","Question","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){u(),l()}function s(t){var e=t?p.allTopics.filter(a(t)):[];return e}function a(t){return function(e){return e.name.indexOf(t)!==-1}}function u(){o.list().$promise.then(function(t){p.allTopics=t.data,p.querySearch=s,location.href="/#topic/56d6f9a7eb0e07a804e952c9"})}function l(){var t=i.getCookie("uid");n.getFollowingTopic({_id:t}).$promise.then(function(t){console.log(t),p.topics=t.data.topics})}function c(){var t=d(),e=!0;if(0===t.length&&(e=confirm("你确认要取消所有订阅么？")),e){var o={_id:i.getCookie("uid"),following_topic:t};console.log(o),n.update(JSON.stringify(o)).$promise.then(function(t){t.status>-1?(console.log(t),alert("关注的话题已更新")):(alert("程序出错"),console.log(t))})}}function d(){var t=p.topics.map(function(t){return t._id});return t}var p=this;p.querySearch="",p.allTopics=[],p.topics=[],p.filterSelected=!0,p.updateFollowingTopic=c,r()}t.module("waka").controller("topicController",["$scope","$state","Topic","User","iCookie",e])}(angular),function(t){"use strict";function e(e,o,n,i,r,s){function a(){r.get({_id:c()}).$promise.then(function(t){p.currentTopic=t.data,l(t.data._id),t.data.parent?u(t.data.parent):p.parentTopic={name:"无"}})}function u(t){r.get({_id:t}).$promise.then(function(t){p.parentTopic=t.data})}function l(t){r.sub({_id:t}).$promise.then(function(t){p.subTopicList=t.data})}function c(){return location.href.split("#/topic/")[1]}function d(e){i.show({template:'<topic-dialog parent-topic="tree.initTree()"></topic-dialog>',parent:t.element(document.body),targetEvent:e,clickOutsideToClose:!0}).then(function(t){})}var p=this;p.parentTopic="",p.currentTopic="",p.subTopicList="",p.showTopicDialog=d,a()}t.module("waka").controller("topicTreeController",["$scope","$state","$stateParams","$mdDialog","Topic","User",e])}(angular),function(t){"use strict";function e(t,e,o,n){function i(t){n.login(t).$promise.then(function(n){if(console.log(n),n.status===-1)switch(n.error){case"user":case"password":return c.auth.loginErr=!0,void e(r,4e3)}n.status>-1&&(a("uid")||(console.log("set cookie"),s(n.data._id,n.data.username,t.password)),e(function(){o.go("home-page")},1e3))})}function r(){c.auth={email:!1,pass:!1,userExist:!1,loginErr:!1,emailExist:!1}}function s(t,e,o){e=u(e),o=u(o),document.cookie="uid="+t+";max-age=864000",document.cookie="username="+e+";max-age=864000",document.cookie="password="+o+";max-age=864000"}function a(t){var e=document.cookie;if(e){e=e.substr(e.indexOf(t));var o=e.indexOf(";")>-1?e.indexOf(";"):e.length,n=e.substring(e.indexOf("=")+1,o);return n}return null}function u(t){return CryptoJS.AES.encrypt(t,"iwaka")}function l(t){return CryptoJS.AES.decrypt(t,"iwaka").toString(CryptoJS.enc.Utf8)}var c=this,d=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;c.signin=!0,c.auth={email:!1,pass:!1,loginErr:!1,userExist:!1,emailExist:!1},function(){if(a("uid")){var t={username:l(a("username")),password:l(a("password"))};i(t)}}(),c.login=function(){var t={email:d.test(c.email)?c.email:"",username:d.test(c.email)?"":c.email,password:c.password};i(t)},c.signup=function(){var t=c.reg;if(t.password!==t.password2)return c.auth.pass=!0,void e(r,4e3);if(!d.test(t.email))return c.auth.email=!0,void e(r,4e3);var o={username:t.username,email:t.email,password:t.password};n.save(o).$promise.then(function(t){if(console.log(t),t.status===-1)switch(t.error){case"email":return c.auth.emailExist=!0,void e(r,4e3);case"username":return c.auth.userExist=!0,void e(r,4e3)}t.status>-1&&(alert("注册成功"),location.reload())},function(t){console.log("signup fail"),console.log(t)})}}t.module("waka").controller("loginController",["$scope","$timeout","$state","User",e])}(angular),function(t){"use strict";function e(t,e,o,n){function i(){o.get({id:n.getCookie("uid")}).$promise.then(function(t){console.log(t),r.user=t.data})}var r=this;r.user="",r.itemList=[{title:"我的提问",url:"question"},{title:"我的回答",url:"answer"},{title:"订阅话题",url:"topic"},{title:"我的消息",url:"mes"},{title:"我的收藏",url:"collection"}],i(),r.userSetting=function(){e.go("user-setting")}}t.module("waka").controller("userPageController",["$scope","$state","User","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){n.getByUser({author_id:a}).$promise.then(function(t){t.status>-1&&(s.answerList=t.data)})}var s=this,a=i.getCookie("uid");s.answerList=[],r()}t.module("waka").controller("userAnswerController",["$scope","$state","User","Answer","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){n.collection({user_id:a}).$promise.then(function(t){console.log("getCollection"),s.collectionList=t.data})}var s=this,a=i.getCookie("uid");s.collectionList=[],r()}t.module("waka").controller("userCollectionController",["$scope","$state","User","Answer","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i,r){function s(){var t={master_id:u};i.getMes(JSON.stringify(t)).$promise.then(function(t){t.status>-1&&(console.log("mes"),a.mesList=t.data)})}var a=this,u=r.getCookie("uid");a.mesList=[],s()}t.module("waka").controller("userMesController",["$scope","$state","User","Question","Message","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){n.getByUser({author_id:a}).$promise.then(function(t){t.status>-1&&(s.questionList=t.data)})}var s=this,a=i.getCookie("uid");s.questionList=[],r()}t.module("waka").controller("userQuestionController",["$scope","$state","User","Question","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){s(function(t){var e={topicIdList:t};n.getTopicByIdList(JSON.stringify(e)).$promise.then(function(t){t.status>-1&&(a.topicList=t.data)})})}function s(t){o.getCurrentUser().$promise.then(function(e){e.status>-1&&t(e.data.following_topic)})}var a=this;i.getCookie("uid");a.topicList=[],r()}t.module("waka").controller("userTopicController",["$scope","$state","User","Topic","iCookie",e])}(angular),function(t){"use strict";function e(t,e,o,n,i){function r(){n.getCurrentUser().$promise.then(function(t){var e=t.data;u.username=e.username,u.bio=e.bio,u.description=e.description})}function s(t){t=a(t),document.cookie="password="+t+";max-age=864000"}function a(t){return CryptoJS.AES.encrypt(t,"iwaka")}var u=this;u.picFile="",u.username="",u.bio="",u.description="",u.oldPassword="",u.newPassword="",u.newPassword2="",u.savingAvatar=!1,u.savingInfo=!1,u.savingPassword=!1,r(),u.updateInfo=function(){var t={username:u.username,bio:u.bio,description:u.description};n.update(t).$promise.then(function(t){u.savingInfo=!0,t.status>-1&&o(function(){u.savingInfo=!1,u.savingInfoMes="保存成功"},2e3)})},u.updatePassword=function(){u.newPassword!==u.newPassword2&&(u.savingPasswordMes="密码不一致");var t={oldPassword:u.oldPassword,newPassword:u.newPassword};n.updatePassword(t).$promise.then(function(t){u.savingPassword=!0,console.log(t),t.data.error?(u.savingPassword=!1,u.savingPasswordMes="旧密码不正确"):o(function(){u.savingPassword=!1,u.savingPasswordMes="保存成功",s(u.newPassword)},2e3)})},u.upload=function(t){u.savingAvatar=!0,i.upload({url:"/api/user/imgUpload",file:i.dataUrltoBlob(t)}).then(function(t){t.status>-1&&o(function(){window.location.reload()},2500)})}}t.module("waka").controller("userSettingController",["$scope","$state","$timeout","User","Upload",e])}(angular);